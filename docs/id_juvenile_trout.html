<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Identifying anadromous and resident-origin rainbow trout juveniles</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./id_juvenile_trout.html">Science Summaries</a></li><li class="breadcrumb-item"><a href="./id_juvenile_trout.html">Identifying anadromous and resident-origin rainbow trout juveniles</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Home</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">index.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Science Summaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./id_juvenile_trout.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Identifying anadromous and resident-origin rainbow trout juveniles</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">More</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#question-and-context" id="toc-question-and-context" class="nav-link active" data-scroll-target="#question-and-context">Question and context</a></li>
  <li><a href="#plain-words-summary" id="toc-plain-words-summary" class="nav-link" data-scroll-target="#plain-words-summary">Plain-words summary</a></li>
  <li><a href="#technical-summary" id="toc-technical-summary" class="nav-link" data-scroll-target="#technical-summary">Technical summary</a>
  <ul class="collapse">
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./id_juvenile_trout.html">Science Summaries</a></li><li class="breadcrumb-item"><a href="./id_juvenile_trout.html">Identifying anadromous and resident-origin rainbow trout juveniles</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Identifying anadromous and resident-origin rainbow trout juveniles</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="question-and-context" class="level2">
<h2 class="anchored" data-anchor-id="question-and-context">Question and context</h2>
<p><em>Oncorhynchus mykiss</em> is a species exhibiting partial migration: some individuals are anadromous, completing a marine migration, while resident individuals undergo their life cycle in freshwater. Differentiation of adult anadromous and resident <em>Oncorhynchus mykiss</em> (known as steelhead and rainbow trout, respectively), is straightforward, but distinguishing juveniles of each life-history origin is more challenging due to a lack of morphological difference. This makes it difficult to understand the composition of a population and make management decisions related to migrations and the mixing of different life-history forms.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="STEELHEAD.jpeg" class="img-fluid figure-img"></p>
<figcaption>Steelhead</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="RBT.jpeg" class="img-fluid figure-img"></p>
<figcaption>Rainbow trout</figcaption>
</figure>
</div>
</section>
<section id="plain-words-summary" class="level2">
<h2 class="anchored" data-anchor-id="plain-words-summary">Plain-words summary</h2>
<p>Several ways to distinguish anadromous-origin and resident-origin juvenile trout have been studied. Analysis of otoliths, sensory structures that help fish hear, is one method for determining origin, thanks to size differences and the signatures left by freshwater and seawater during development. Sometimes, genetic analysis can identify the offspring of anadromous versus resident spawners. For small juvenile fish, stable isotopes of carbon and nitrogen can be used to determine maternal origin.</p>
<p>Additionally, characteristics of redds and spawn timing can indicate whether juvenile trout are anadromous- or resident-origin. Anadromous trout typically spawn earlier than resident rainbow trout and produce larger eggs, meaning that their offspring will be larger during the first summer of life. Steelhead are also typically larger-bodied, and use larger gravel substrates and deeper nests corresponding to their body size. Finally, since steelhead generally produce more fry than resident rainbow trout, their spawning areas may contain higher fry densities than those used by resident rainbow trout.</p>
</section>
<section id="technical-summary" class="level2">
<h2 class="anchored" data-anchor-id="technical-summary">Technical summary</h2>
<section id="methods" class="level3">
<h3 class="anchored" data-anchor-id="methods">Methods</h3>
<section id="otolith-analysis" class="level4">
<h4 class="anchored" data-anchor-id="otolith-analysis">Otolith analysis</h4>
<p><em>Otolith size</em></p>
<p>The size of the otolith nucleus, a structure formed during early development, in juvenile rainbow trout can be used to indicate their origin. This hypothesis was tested by Rybock et al (1975), who compared otolith nucleus sizes between juveniles of known origin. They determined that otolith nucleus size reliably differentiates anadromous vs resident-origin rainbow trout. Steelhead otolith nuclei were significantly larger than rainbow otolith nuclei, and otolith nucleus size was not found to change with growth or depend on sex. This study also measured otolith nuclei in relation to body size and egg size to look for correlations. The authors concluded that larger egg size, correlated with larger body size at maturity, in steelhead is likely responsible for the larger otolith nucleus size compared to resident trout offspring.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ON_size.jpeg" class="img-fluid figure-img"></p>
<figcaption>Otolith size</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="body_size.jpeg" class="img-fluid figure-img"></p>
<figcaption>Body size</figcaption>
</figure>
</div>
<p><em>Otolith microchemistry</em></p>
<p>Microchemistry of otoliths can also identify juvenile rainbow trout origin, since development in freshwater versus saltwater influences the composition of bone structures. The concentration of strontium is higher in saltwater than in freshwater, so fish spending part of their life cycle in ocean waters generally have higher levels of strontium in their otoliths (Zimmermann et al.&nbsp;2009). The ratio of strontium to calcium of the natal stream is strongly correlated with the ratio of Sr:Ca in the otoliths of offspring, for both forms of <em>O. mykiss</em> (Donohoe et al.&nbsp;2008).</p>
<p>The Sr:Ca ratio in the otolith was shown to be effective at differentiating juvenile rainbow trout from anadromous and resident origin (McMillan et al.&nbsp;2015). Otoliths were collected from <em>O. mykiss</em> fry, with 30 fry known to be steelhead offspring, 28 of unknown origin, and 12 known to be rainbow trout offspring. Steelhead offspring were identified as those individuals with a Sr:Ca ratio significantly higher than that found in known rainbow-trout offspring, and not significantly different from known steelhead offspring, while fry were classified as resident-origin when they had a significantly lower Sr:Ca ratio than known steelhead and no significant difference from known rainbow trout offspring. Zimmerman and Reeves (2002) had similar findings, based on a study in which they reared juvenile trout of anadromous and resident origin and measured Sr:Ca ratios, which were then used to identify unknown juveniles. Again, Sr:Ca was significantly higher in the anadromous-offspring trout.</p>
</section>
<section id="genetic-methods" class="level4">
<h4 class="anchored" data-anchor-id="genetic-methods">Genetic methods</h4>
<p>There is a “moderate to strong” genetic component to <em>O. mykiss</em> life histories, though more research is needed on the extent and mechanisms of heritibility. Fish displaying each life history can produce offspring with the other life history. However, there appear to be maternal effects: studies have observed offspring of anadromous mothers are more likely to become anadromous, as they reach a larger size than resident offspring, and a higher proportion of resident rainbow trout came from resident mothers (Kendall et al.&nbsp;2014).</p>
</section>
<section id="stable-isotope-analysis" class="level4">
<h4 class="anchored" data-anchor-id="stable-isotope-analysis">Stable isotope analysis</h4>
<p>Carbon stable isotope ratios can be used to distinguish offspring of migratory forms of trout (Briers et al.&nbsp;2012). Stable isotope analysis is done by sampling muscle tissue from fry and using mass spectrometry to measure isotope ratios. This method proved to be effective for distinguishing offspring of anadromous and resident origin; however, isotope ratios change significantly over time. The distinction in stable isotope ratios diffuses around 6 or 7 months of age, making this technique only suitable for young trout.</p>
</section>
<section id="redd-characteristics" class="level4">
<h4 class="anchored" data-anchor-id="redd-characteristics">Redd characteristics</h4>
<p>Inspection of redds is another way to classify offspring of steelhead and rainbow trout, due to the different size, behaviour, and fecundities of the two forms. Using biweekly redd surveys in the Elwha River, McMillan et al (2015) observed significant differences between steelhead and rainbow trout redd size, time of construction, and substrate particle size. Steelhead redds were measured to be both longer and wider than rainbow trout redds; the difference was so substantial that there was no overlap in the ranges of redd sizes, and it could be inferred that redds larger than 0.3 square meters were constructed by steelhead while redds smaller than 0.2 square meters were constructed by rainbow trout.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="redd_size.jpeg" class="img-fluid figure-img"></p>
<figcaption>Redd sizes</figcaption>
</figure>
</div>
<p>Median substrate particle size was significantly larger in steelhead redds compared to resident rainbow trout redds. Based on the observations in the Elwha River, redds with media substrate particles greater than 33 mm were made by steelhead, and redds with median particle size less than 30 mm were made by rainbow trout.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pebble.jpeg" class="img-fluid figure-img"></p>
<figcaption>Redd substrate particle size</figcaption>
</figure>
</div>
</section>
<section id="offspring-characteristics" class="level4">
<h4 class="anchored" data-anchor-id="offspring-characteristics">Offspring characteristics</h4>
<p>Fry density was significantly higher in steelhead spawning reaches than in rainbow trout spawning reaches (McMillan et al.&nbsp;2015), which can be explained by the higher fecundity of steelhead. Therefore, in reaches with very high fry density, these juveniles may be more likely to be anadromous-origin. Although steelhead generally spawn earlier than rainbow trout, size differences between the offspring of the two forms were not significantly different, so offspring size may not be a reliable indicator of origin.</p>
</section>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Briers, R.A., Waterman, J.O., Galt, K., and Campbell, N.B. 2012. Population differentiation and temporal changes of carotenoid pigments and stable isotope ratios in the offspring of anadromous and non-anadromous trout <em>Salmo trutta</em>. Ecology of Freshwater Fish 22: 137-144.</p>
<p>Donohoe, C.J., Adams, P.B., and Royer, C.F. 2008. Influence of water chemistry and migratory distance on ability to distinguish progeny of sympatric resident and anadromous rainbow trout <em>(Oncorhynchus mykiss).</em> Canadian Journal of Fisheries and Aquatic Science 65: 1060-1075.</p>
<p>Kendall, N.W., McMillan, J.R., Sloat, M.R., Buehrens, T.W., Quinn, T.P., Pess, G.R., Kuzischin, K.V., McClure, M.M., and Zabel, R.W. 2014. Anadromy and residency in steelhead and rainbow trout <em>(Oncorhynchus mykiss)</em>: a review of the processes and patterns. Canadian Journal of Fisheries and Aquatic Science 72: 319-342.</p>
<p>McMillan, J.R., Pess, G.R., Liermann, M., Morley, S.A., McHenry, M.L., Campbell, L.A., and Quinn, T.P. 2015. Using redd attributes, fry density, and otolith microchemistry to distinguish the presence of steelhead and rainbow trout in the Elwha River Dam Removal Project. North American Journal of Fisheries Management 35(5): 1019-1033.</p>
<p>Rybock, J.T., Horton, H.F. and Fessler, J.L. 1975. Use of otoliths to separate juvenile steelhead trout from juvenile rainbow trout. Fishery Bulletin 73(3): 654-659.</p>
<p>Zimmerman, C.E. and Reeves, G.H. 2002. Identification of steelhead and resident rainbow trout progeny in the Deschutes River, Oregon, revealed with otolith microchemistry. Transactions of the American Fisheries Society 131: 986-993.</p>
<p>Zimmerman, C.E., Edwards, G.W., and Perry, K. 2009. Maternal origin and migratory history of steelhead and rainbow trout captured in rivers of the Central Valley, California. Transactions of the American Fisheries Society 138: 280-291.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>